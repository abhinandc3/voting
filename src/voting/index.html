<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Election Results</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container" style="width: 650px">
      <div class="row">
        <div class="col-lg-12">
          <h1 class="text-center">Election Results</h1>
          <hr />
          <br />
          <div id="loader">
            <p class="text-center">Loading...</p>
          </div>
          <div id="content" style="display: none">
            <div id="votedMessage">
              <h3 class="text-center">
                You Have Already Voted In This Poll, Thank you.
              </h3>
              <a class="btn btn-primary" href="/result_u.html">See Result</a>
            </div>
            <hr />
            <div class="container" style="padding-top: 10%">
                        
              <div id="content" class="w-100">
                  <table class="table">
                    <thead>
                      
                        <th >candidate no</th>
                        <th  style="text-align: center">Name</th>
                      
                      
                    </thead>
                    <tbody id="voters"></tbody>
                  </table>
              </div>
            </div>
            <form onSubmit="App.castVote(); return false;">
              <div class="form-group">
                <label for="candidatesSelect">Select Candidate</label>
                <select class="form-control" id="candidatesSelect"></select>
              </div>
              <button type="submit" class="btn btn-primary">Vote</button>
              <hr />
            </form>
            <p id="accountAddress" class="text-center"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/web3.min.js"></script>
    <script src="js/truffle-contract.js"></script>
    <script src="js/app.js"></script>
  </body>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.2/firebase-app.js";
    import { getDatabase, ref, set, get, child, onValue  } from "https://www.gstatic.com/firebasejs/9.8.2/firebase-database.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAfgvfeX2tyWtBXL2y2L0AeOGRwW70jCjY",
      authDomain: "candidate-d2d95.firebaseapp.com",
      databaseURL: "https://candidate-d2d95-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "candidate-d2d95",
      storageBucket: "candidate-d2d95.appspot.com",
      messagingSenderId: "279669923283",
      appId: "1:279669923283:web:c0419418106db4a315e326"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    var candidateno = 0;
    var tbody = document.getElementById('voters')
    function AddItemsToTable(name){
        
        let trow = document.createElement('tr');
        let td1 = document.createElement('td');
        let td2 = document.createElement('td');
        td1.innerHTML = ++candidateno;
        td2.innerHTML = name;
        trow.appendChild(td1);
        trow.appendChild(td2);
        tbody.appendChild(trow);      
    }
    function AddAllItemsToTable(users){
        candidateno=0;
        tbody.innerHTML="";
        users.forEach(element => {
            AddItemsToTable(element.name);

        }
        );
    }
    function GetallData(){
        const dbRef =ref(db,"users");
        onValue(dbRef,(snapshot)=> {
            var voters = [];

            snapshot.forEach(childSnapshot => {
                voters.push(childSnapshot.val());



        });
        AddAllItemsToTable(voters);
    })



    }

    window.onload = GetallData;
  
    // Initialize Firebase
    </script>
</html>
